# Quarkus CA (Certificate Authority) Configuration

quarkus:
  # Application
  application:
    name: pki-ca-quarkus
    version: 11.10.0-SNAPSHOT

  # HTTP Configuration
  http:
    root-path: /ca
    port: 8080
    ssl-port: 8443

    # Allow HTTP requests (SSL/TLS to be configured per deployment)
    insecure-requests: enabled

    # Security Constraints (replaces web.xml)
    auth:
      basic: true
      permission:
        # Account services: require authentication
        account:
          paths: /v2/account/*
          policy: authenticated
        # Admin services (groups, users): require authentication
        admin:
          paths: /v2/admin/*
          policy: authenticated
        # Audit: require authentication
        audit:
          paths: /v2/audit/*
          policy: authenticated
        # Agent cert operations: require authentication
        agent-certs:
          paths: /v2/agent/certs/*
          policy: authenticated
        # Agent cert request operations: require authentication
        agent-certrequests:
          paths: /v2/agent/certrequests/*
          policy: authenticated
        # Authorities (sub-CAs): require authentication
        authorities:
          paths: /v2/authorities/*
          policy: authenticated
        # Certificates: public (read-only listing and retrieval)
        certs:
          paths: /v2/certs/*
          policy: permit
        # Certificate requests: public (enrollment endpoints)
        certrequests:
          paths: /v2/certrequests/*
          policy: permit
        # Profiles: require authentication for management
        profiles:
          paths: /v2/profiles/*
          policy: authenticated
        # System config: require authentication
        config:
          paths: /v2/config/*
          policy: authenticated
        # Self tests: require authentication
        selftests:
          paths: /v2/selftests/*
          policy: authenticated
        # Jobs: require authentication
        jobs:
          paths: /v2/jobs/*
          policy: authenticated
        # CA info: public
        info:
          paths: /v2/info
          policy: permit
        # Security domain install token: require authentication
        security-domain-install:
          paths: /v2/securityDomain/installToken
          policy: authenticated
        # Security domain info: public
        security-domain-info:
          paths: /v2/securityDomain/domainInfo,/v2/securityDomain/hosts,/v2/securityDomain/hosts/*
          policy: permit
        # EE enrollment (profileSubmit): public (auth handled internally by profile authenticator)
        ee-enrollment:
          paths: /ee/ca/profileSubmit
          policy: permit
        # Token authenticate endpoints: public (validates install tokens internally)
        token-auth:
          paths: /ee/ca/tokenAuthenticate,/admin/ca/tokenAuthenticate
          policy: permit

  # Class Loading - remove xml-apis which conflicts with JDK's java.xml module
  class-loading:
    removed-artifacts:
      - xml-apis:xml-apis

  # Security
  security:
    users:
      embedded:
        enabled: false

  # Logging
  log:
    level: INFO
    category:
      "org.dogtagpki.server.ca":
        level: DEBUG
      "com.netscape.ca":
        level: DEBUG
      "com.netscape.certsrv":
        level: INFO
      "io.quarkus":
        level: INFO
    console:
      enable: true
      format: "%d{yyyy-MM-dd HH:mm:ss,SSS} %-5p [%c{3.}] (%t) %s%e%n"

  # Native compilation options (for GraalVM native-image)
  native:
    enable-http-url-handler: true
    enable-https-url-handler: true
