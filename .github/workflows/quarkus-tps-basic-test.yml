name: Basic Quarkus TPS

on: workflow_call

jobs:
  # Smoke test for TPS subsystem running on Quarkus
  test:
    name: Test
    runs-on: ubuntu-latest
    steps:
      - name: Clone repository
        uses: actions/checkout@v4

      - name: Retrieve PKI images
        uses: actions/cache@v4
        with:
          key: pki-images-${{ github.sha }}
          path: pki-images.tar

      - name: Load PKI images
        run: docker load --input pki-images.tar

      - name: Verify TPS Quarkus image structure
        run: |
          echo "Checking TPS Quarkus image..."

          docker run --rm pki-quarkus-tps \
              test -f /usr/share/pki/quarkus/tps/quarkus-run.jar
          echo "  OK: quarkus-run.jar exists"

          docker run --rm pki-quarkus-tps \
              java -version
          echo "  OK: Java runtime available"

          docker run --rm pki-quarkus-tps \
              ls -la /usr/share/pki/quarkus/tps/
          echo "  OK: Quarkus app directory listing"
